# Management Portal - Docker Setup

## Prerequisites
- Docker and Docker Compose installed
- At least 4GB RAM available for Docker

## Quick Start

1. **Clone the repository** (if not already done)

2. **Set up environment variables**
   ```bash
   cp .env.example server/.env
   # Edit server/.env with your database credentials
   ```

3. **Build and start all services**
   ```bash
   docker-compose up -d
   ```

4. **Access the application**
   - Frontend: http://localhost:3000
   - Backend API: http://localhost:8080
   - MySQL: localhost:3306

## Services

### Frontend (React)
- Built with React using create-react-app
- Served with Nginx
- Port: 3000 (mapped to 80 inside container)
- Auto-rebuild on code changes in development

### Backend (Go)
- Go server with Gorilla Mux
- Includes Chrome/Chromium for PDF generation
- Port: 8080
- Connects to MySQL database

### MySQL Database
- MySQL 8.0
- Port: 3306
- Persistent volume for data storage
- Health checks enabled

## Common Commands

### Start all services
```bash
docker-compose up -d
```

### Stop all services
```bash
docker-compose down
```

### View logs
```bash
# All services
docker-compose logs -f

# Specific service
docker-compose logs -f backend
docker-compose logs -f frontend
docker-compose logs -f mysql
```

### Rebuild after code changes
```bash
# Rebuild specific service
docker-compose up -d --build backend

# Rebuild all services
docker-compose up -d --build
```

### Access MySQL
```bash
docker-compose exec mysql mysql -u root -p
```

### Execute commands in containers
```bash
# Backend shell
docker-compose exec backend sh

# Frontend shell
docker-compose exec frontend sh
```

## Environment Variables

Create a `.env` file in the `server/` directory:

```env
DB_HOST=mysql
DB_PORT=3306
DB_USER=portal_user
DB_PASSWORD=your_secure_password
DB_NAME=management_portal
PORT=8080
ENV=production
```

## Volumes

- **mysql_data**: Persistent MySQL data
- **./server/uploads**: File uploads directory
- **./server/pdfs**: Generated PDFs directory

## Health Checks

All services include health checks:
- Frontend: HTTP check on port 80
- Backend: HTTP check on /health endpoint
- MySQL: mysqladmin ping

## Troubleshooting

### Port conflicts
If ports 3000, 8080, or 3306 are already in use, modify the port mappings in `docker-compose.yml`:
```yaml
ports:
  - "3001:80"  # Change frontend port to 3001
```

### Database connection issues
1. Check if MySQL is healthy:
   ```bash
   docker-compose ps
   ```
2. Check backend logs:
   ```bash
   docker-compose logs backend
   ```

### Rebuild from scratch
```bash
docker-compose down -v  # Remove volumes
docker-compose build --no-cache
docker-compose up -d
```

## Production Deployment

For production deployment:

1. Update environment variables with production values
2. Use proper secrets management (not .env files)
3. Consider using Docker Swarm or Kubernetes
4. Set up proper backup strategy for MySQL data
5. Configure SSL/TLS for Nginx
6. Set up monitoring and logging

## Network

All services communicate through the `management-portal-network` bridge network.

## Development

For development with hot-reload:

1. Run database only:
   ```bash
   docker-compose up -d mysql
   ```

2. Run frontend and backend locally:
   ```bash
   # Terminal 1 - Frontend
   cd client && npm start

   # Terminal 2 - Backend
   cd server && go run main.go
   ```

This allows for faster development with hot-reload while using the containerized database.
